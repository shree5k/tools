<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stroll</title>
    <style>
        body {
            font-family: "Times New Roman", Times, serif;
            background-color: #fff;
            color: #000;
            margin: 0;
            padding: 20px;
            text-align: left;
        }

        .content {
            max-width: 300px;
            margin: 40px auto;
        }

        #date-display {
            position: fixed;
            top: 25px;
            right: 25px;
            font-size: 13px;
            font-style: italic;
            color: #aaa;
        }

        .icon-sun {
            text-align: left;
            margin: 20px 0 50px 0;
            font-size: 24px;
            opacity: 0.6;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 45px;
            margin-bottom: 40px;
        }

        .city-block {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .city-name {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .time-row {
            font-size: 24px; /* Bigger focus since only one line */
            line-height: 1.2;
        }

        .status {
            font-size: 13px;
            color: #888;
            margin-top: 4px;
            font-style: italic;
        }

        .status strong {
            color: #000;
            font-style: normal;
        }

        details {
            width: 100%;
            max-width: 500px;
        }

        summary {
            font-weight: normal;
            text-align: left;
        }

        details pre {
            font-family: inherit;
            white-space: pre-wrap;
            margin-top: 15px;
            line-height: 1.5;
            color: #333;
            text-align: justify;
        }
        .full-moon {
            text-align: left;
            margin-bottom: 20px;
            font-size: 14px;
            opacity: 0.8;
            color: grey;
        }
    </style>
</head>
<body>

    <div id="date-display">...</div>

    <div class="content">
        <div class="icon-sun">ð“‚ƒ à½¼â˜€ï¸Žð“‚ƒ
            <p style="font-size: 13px; margin: 0;">(take a stroll at the golden hour)</p>
        </div>
        <div class="container">
            <!-- Mysore -->
            <div class="city-block">
                <span class="city-name">Mysore</span>
                <div class="time-row" id="mys-time">--:--</div>
                <div class="status" id="mys-status">...</div>
            </div>

            <!-- Bangalore -->
            <div class="city-block">
                <span class="city-name">Bangalore</span>
                <div class="time-row" id="blr-time">--:--</div>
                <div class="status" id="blr-status">...</div>
            </div>
        </div>
        <div id="moon-display" class="full-moon"></div>
        <details>
            <summary>science behind the golden hour</summary>
            <pre>Golden hour is just sun hanging low. 

When it's about 0Â°â€“6Â° above the horizon, the light has to travel more. 

So it softens, warms up, and throws those long, dramatic colors everyone loves.</pre>
        </details>
    </div>

    <script>
        const CITIES = {
            mysore: { lat: 12.2958, lng: 76.6394 },
            bangalore: { lat: 12.9716, lng: 77.5946 }
        };

        // --- TIMEZONE & DATE ---
        function getISTDate() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            return new Date(utc + (3600000 * 5.5));
        }

        // --- FULL MOON CALCULATION ---
        function isFullMoon(date) {
            const referenceFullMoon = new Date(2025, 0, 14);
            const lunarCycle = 29.53 * 24 * 60 * 60 * 1000;

            const diff = date - referenceFullMoon;
            const cycles = Math.round(diff / lunarCycle);
            const calculatedFullMoon = new Date(referenceFullMoon.getTime() + cycles * lunarCycle);

            const dayDiff = Math.abs(date - calculatedFullMoon) / (24 * 60 * 60 * 1000);
            return dayDiff <= 1;
        }

        const d = getISTDate();
        const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        document.getElementById('date-display').textContent =
            `${days[d.getDay()]} ${months[d.getMonth()]} ${d.getFullYear()}`;

        if (isFullMoon(d)) {
            document.getElementById('moon-display').innerHTML = 'ð“‡¸ btw its full moon tonight ð“‡¸';
        }

        function toRad(deg) { return deg * (Math.PI / 180); }
        function toDeg(rad) { return rad * (180 / Math.PI); }

        function calculateSunTimes(dateObj, lat, lng) {
            const start = new Date(dateObj.getFullYear(), 0, 0);
            const diff = dateObj - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const N = Math.floor(diff / oneDay);

            const delta = 23.44 * Math.sin(toRad((360 / 365) * (N + 284)));
            const B = toRad((360 / 365) * (N - 81));
            const eot = 9.87 * Math.sin(2 * B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B);
            const solarNoonUtc = 720 - (4 * lng) - eot;

            function getOffset(angle) {
                const numer = Math.sin(toRad(angle)) - (Math.sin(toRad(lat)) * Math.sin(toRad(delta)));
                const denom = Math.cos(toRad(lat)) * Math.cos(toRad(delta));
                const val = Math.max(-1, Math.min(1, numer / denom));
                return toDeg(Math.acos(val)) * 4; 
            }

            const offLow = getOffset(0); 
            const offHigh = getOffset(6);

            function utcMinsToISTDate(mins) {
                const result = new Date(dateObj); 
                result.setHours(0,0,0,0); 
                result.setMinutes(mins + 330);
                return result;
            }

            return {
                m_start: utcMinsToISTDate(solarNoonUtc - offLow),
                m_end: utcMinsToISTDate(solarNoonUtc - offHigh),
                e_start: utcMinsToISTDate(solarNoonUtc + offHigh),
                e_end: utcMinsToISTDate(solarNoonUtc + offLow)
            };
        }

        function fmt(dateObj) {
            let h = dateObj.getHours();
            let m = dateObj.getMinutes();
            let ampm = h >= 12 ? 'pm' : 'am';
            h = h % 12 || 12;
            m = m < 10 ? '0'+m : m;
            return `${h}:${m}${ampm}`;
        }

        function getUpcomingWindow(now, lat, lng) {
            const todayTimes = calculateSunTimes(now, lat, lng);
            
            // 1. Is it currently Morning Golden Hour or Before?
            if (now <= todayTimes.m_end) {
                return { 
                    label: "Morning", 
                    start: todayTimes.m_start, 
                    end: todayTimes.m_end,
                    isTomorrow: false
                };
            }

            // 2. Is it currently Evening Golden Hour or Before?
            if (now <= todayTimes.e_end) {
                return { 
                    label: "Evening", 
                    start: todayTimes.e_start, 
                    end: todayTimes.e_end,
                    isTomorrow: false
                };
            }

            // 3. Evening passed? Get Tomorrow Morning.
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tmrwTimes = calculateSunTimes(tomorrow, lat, lng);
            
            return { 
                label: "Morning", 
                start: tmrwTimes.m_start, 
                end: tmrwTimes.m_end,
                isTomorrow: true
            };
        }

        function getStatus(now, win) {
            // Check if active
            if (now >= win.start && now <= win.end) return `Take a stroll`;

            // Countdown
            if (now < win.start) {
                const diff = win.start - now;
                const hrs = Math.floor(diff / 3600000);
                const mins = Math.floor((diff % 3600000) / 60000);
                
                let timeStr = "";
                if (hrs === 0) timeStr = `${mins} mins`;
                else timeStr = `${hrs}h ${mins}m`;

                return win.isTomorrow ? `Tomorrow in ${timeStr}` : `In ${timeStr}`;
            }
            return "";
        }

        // --- RENDER ---
        function renderCity(prefix, lat, lng) {
            const now = getISTDate();
            const win = getUpcomingWindow(now, lat, lng);
            const status = getStatus(now, win);

            document.getElementById(`${prefix}-time`).innerText = `${fmt(win.start)} - ${fmt(win.end)}`;
            document.getElementById(`${prefix}-status`).innerHTML = status;
        }

        function update() {
            renderCity('mys', CITIES.mysore.lat, CITIES.mysore.lng);
            renderCity('blr', CITIES.bangalore.lat, CITIES.bangalore.lng);
        }

        update();
        setInterval(update, 60000);

    </script>
</body>
</html>